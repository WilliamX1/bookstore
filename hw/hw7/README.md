# hw7
#### id: 519021910861
#### name: xuhuidong
------
<font color=red> 以下是 pdf-13 内容 </font>

### 要求
1. 详细描述如何通过全量备份和增量备份来实现系统状态恢复。
2. 根据 MySQL 缓存的工作原理，描述预取机制的优点。

### 备份方式

* 物理备份 VS 逻辑备份
**物理备份** 直接将用于存储的文件和文件夹复制，适用于大型的、重要的且需要迅速恢复的内容。
速度较快，备份粒度从整个文件结构到单个文件，可以备份 `log` 文件和 `configuration` 文件。
不可以用于在内存中还没写入文件的数据，可以在 `MySQL server` 离线时进行备份。
**逻辑备份** 将内容转换成数据库的逻辑结构的条目 `CREATE` `INSERT` 等，适用于小型的、可能运行在不同机器结构电脑上的内容。
速度较慢，备份粒度可以细到单个表，不可以备份 `log` 和 `configuration` 文件。
可以用于在内存中还没写入文件的数据，需要在 `MySQL server` 在线时进行备份。

* 在线备份 VS 离线备份
区别在于 `MySQL server` 是否运行。
在线备份对其他 `Client` 影响较小，需要对部分数据上锁。
离线备份需要将 `Server` 下线，对 `Client` 影响大，但操作简单不需要考虑锁。

* 本地备份 VS 远程备份
区别在于 `MySQL Server` 是否运行在同一 `host`。

* 快照备份

* 全量备份 VS 增量备份
全量备份包括 `MySQL server` 当前时间点的全部数据。
增量备份仅包括某一时间段所有的数据改动。可以通过开启 `Server` 的**二进制日志**来实现。

* 全量恢复 VS 时间点（增量）恢复

### 备份和恢复工具
* MySQL Enterprise Backup
* mysqldump
* Copying Table Files
* Delimited-Text File
* Enabling the Binary Log
* Replicas
* Recover Corrupt Tables
* File System Snapshot

### mysqldump 使用
将数据库数据导出到文件。
```cmd
# 将输出存储在一个文件中
shell > mysqldump [arguments] > file_name
# 导出所有数据库
shell > mysqldump --all-databases > dump.sql
# 导出指定数据库
shell > mysqldump --databases db1 db2 db3 > dump.sql
# 导出指定数据库中指定列
shell > mysqldump database col1 col2 col3 > dump.sql
```
将备份数据导入到数据库。
```cmd
# 整个数据库导入
shell > mysql < dump.sql
mysql > source dump.sql
# 需要增加表
shell > mysqladmin create db1
shell > mysql db1 < dump.sql
```

### 作业
##### 详细描述如何通过全量备份和增量备份来实现系统状态恢复。
1. 全量备份
* 原理：指对某一个时间点上的所有数据或应用进行的一个完全拷贝。实际应用中就是用一盘磁带对整个系统进行全量备份，包括其中的系统和所有数据。
* 优点：备份与恢复操作简单方便。
* 缺点：数据存在大量的重复，会占用大量的备份空间，备份与恢复时间长。
2. 增量备份
* 原理：备份上一次备份后所有发生变化的文件，即增加或修改的文件。
* 优点：没有重复的备份数据，所以备份的数据量不大，备份所需的时间短。
* 缺点：必须拥有上一次全备份和所有增量备份磁带（一旦丢失或损坏其中一盘磁带，就会造成恢复的失败），并且他们必须沿着从全备份到依次增量备份的时间顺序逐个反推恢复，极大消耗恢复时间。
3. 系统恢复通过结合全量备份和增量备份来实现
a. 先还原全量备份。即找到全量备份 SQL 文件并用数据库 `source` 命令导入。
b. 从增量备份里找到数据被 `update` 和 `delete` 乱掉的时间节点。在服务器上找到增量备份文件，并找到数据乱掉的那天的增量备份文件，将这个时间点之前的文件全部按照时间顺序还原，这个时间点之后的增量备份文件不作处理。
c. 将增量备份文件转换成 SQL 文件，可以使用 MySQL 自带工具 $mysqlbinlog$ 将增量备份二进制文件转换成 SQL 文件。
d. 执行增量备份 SQL 文件。按照严格时间先后顺序使用 `source` 命令导入执行备份文件，这样我们就可以将系统恢复到之前某个时间点的状态。
4. 我的 E-Book 系统
可以进行定期（周期时间较长的）的全量备份，比如半个月进行一次，而每次更改数据并保存后可以进行一次（周期时间较短的）增量备份，比如一天一次（如果当天有修改数据库）。这样我如果在某天错误操作数据库导致数据污染时，可以先找到最近的全量备份导入数据库，并将这之后直到当天犯错误前的增量备份按照时间顺序导入数据库，这样就可以将我的数据库恢复到正常的状态。

##### 根据 MySQL 缓存的工作原理，描述预取机制的优点。
* MySQL 缓存工作原理
InnoDB 在 I/O 的优化上相对之前有着独特的预读机制，预读机制是指发起一个 I/O 请求，异步地在缓冲池中预先回迁若干页面，预计将会用到回迁的页面，这些请求在一个范围内引入所有页面。
具体方式就是数据库发起数据请求，请求被提交到文件读取系统，放入相关请求队列中。读取进程从请求队列中把请求去除，根据读取请求到相关的数据存储介质读取数据，返回数据，放入响应队列，最后数据库从响应队列中将数据取走，完成数据读取。
具体有**线性预读**算法和**随机预读**算法。线性预读方式使用一个很重要的变量控制是否将下一个 extent 预读到 buffer pool 中，通过使用配置参数 innodb_read_ahead_threshold 来控制触发 innodb 执行预读操作的时间。随机预读方式则表示当同一个 extent 中的一些 page 在 buffer pool 中发现时，InnoDB 会将该 extent 的剩余 page 一并读到 buffer pool。
* 预读机制优点
由于预读机制会将用户很有可能使用到的数据预先加载到 buffer pool 中，当用户使用到这个数据时，就不必再从磁盘上读入，减少磁盘的 IO 次数，从而提升了数据的读取性能。
### 参考
[13-mysql backup & recovery](./13-mysql backup & recovery.pdf)
https://www.jianshu.com/p/a458a0f3727a
https://www.cnblogs.com/kevingrace/p/6098963.html
https://www.cnblogs.com/geaozhang/p/7397699.html
https://www.jianshu.com/p/3c4ad21f68b9

------
<font color=red> 以下是 pdf-14 内容 </font>

### 要求
阐述 Partition 机制的好处。如果数据文件在一台机器上有足够的存储空间存储，是否还需要进行 Partition？

### 作业
##### 阐述 Partition 机制的好处。如果数据文件在一台机器上有足够的存储空间存储，是否还需要进行 Partition？
* Partition 机制的好处
1. 让我们在一个表中存储的数据可以比单个磁盘或文件系统分区上的数据多。
2. 我们可以将无用的数据通过删除分区表的方式简单移除，而通过添加一个或多个新分区来添加新数据。
3. 可以大大优化某些数据库查询操作，因为满足给定 WHERE 字句的数据只能存储在一个或多个分区上，这样就自动排除搜索中的任何剩余分区，提升了查询的时间性能。
4. 而且 MySQL 支持显式的分区选择查询操作。这样可以减小查询的表范围和数据量，从而提高查询的性能。
5. 涉及到例如 SUM 和 COUNT 这样聚合函数的查询，可以很容易进行并行处理。而通过跨多个磁盘来分散数据查询，可以获得更大的查询吞吐量。
* 如果数据文件在一台机器上有足够的存储空间存储，是否还需要进行 Partition？
**需要！**
因为分区的意义不仅限于拓展磁盘存储空间瓶颈问题和存储更多数据，分区对于数提升数据库性能和改善数据的运维管理都有很大的作用，如上述 Partition 机制的好处，因此当数据量足够大时是有必要进行 Partition 的，这和一台机器上的存储空间大小没有直接关系。

### 参考
[14-mysql partitioning](./14-mysql partitioning.pdf)
https://www.jianshu.com/p/1cdd3e3c5b3c